/*
 * SERVERLESS PLATFORM SDK: RESOURCES
 */

const path = require('path')
const axios = require('axios')
const utils = require('./utils')

/**
 * Get the Serverless Platform User Account
 */
const getUser = async (sdk) => {
  let endpoint = `${sdk.getDomain('core')}/me`

  return await utils.request({
    accessKey: sdk.accessKey,
    endpoint,
    method: `GET`
  })
}

/**
 * Get the Serverless Platform User Account Meta information
 */
const getUserMeta = async (sdk) => {
  let endpoint = `${sdk.getDomain('core')}/users/meta`

  return await utils.request({
    accessKey: sdk.accessKey,
    endpoint,
    method: `GET`
  })
}

/**
 * Get the Serverless Platform User Account Meta information
 */
const saveUserMeta = async (sdk, newMeta = {}) => {

  let existingMeta = await getUserAccountMeta(sdk)

  newMeta = Object.assign(existingMeta || {}, newMeta)

  let endpoint = `${sdk.getDomain('core')}/users/meta`

  return await utils.request({
    accessKey: sdk.accessKey,
    endpoint,
    method: `POST`,
    data: newMeta,
  })
}

module.exports = {
  getUser,
  getUserMeta,
  saveUserMeta,
}
